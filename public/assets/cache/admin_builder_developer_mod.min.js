
var bonfire=bonfire||{};bonfire.builder={legendIcon:{open:'icon-plus',close:'icon-minus'},animation:{easing:'swing',duration:400},prepTableDefaults:{valueToPrep:'',setTableName:true,moduleNameSelector:'#module_name',tableNameSelector:'#table_name',tableNameReplacement:'_',tableNameRegEx:/[^A-Za-z0-9\\s]/g},prepTableName:function(prepOptions){var prepSettings,tableName,event;if(prepOptions&&prepOptions.data){event=prepOptions;prepOptions=prepOptions.data;}
prepSettings=$.extend({},bonfire.builder.prepTableDefaults,prepOptions);tableName=prepSettings.valueToPrep
if(''==tableName){tableName=$(prepSettings.tableNameSelector).val();}
if(''==tableName){tableName=$(prepSettings.moduleNameSelector).val();}
tableName=tableName.replace(prepSettings.tableNameRegEx,prepSettings.tableNameReplacement).toLowerCase();if(prepSettings.setTableName===true){$(prepSettings.tableNameSelector).val(tableName);}
return tableName;}};function showTableProperties(){var tblName,anim=bonfire.builder.animation;if($('#db_create').is(':checked')){$('#db_details').show(anim);$('#db_details .mb_advanced').hide(anim);$('.match-existing-notes').hide(anim);$('.mb_new_table').show(anim);$('#field_numbers').show(anim);$('#all_fields').show(anim);$('#primary_key_field').val(''==$('#primary_key_field').val()?'id':$('#primary_key_field').val());tblName=$('#table_name').val()==''?$('#module_name').val():$('#table_name').val();tblName=bonfire.builder.prepTableName({valueToPrep:tblName,setTableName:true});}
else if($('#db_exists').is(':checked')){$('#db_details').show(anim);$('#db_details .mb_advanced').show(anim);$('.match-existing-notes').show(anim);$('.mb_new_table').hide(anim);$('#field_numbers').hide(anim);$('#all_fields').hide(anim);tblName=$('#table_name').val()==''?$('#module_name').val():$('#table_name').val();tblName=bonfire.builder.prepTableName({valueToPrep:tblName,setTableName:true});if($('#view_field_label1').val()!=undefined&&$('#view_field_label1').val()!=''){$('.mb_new_table').show(anim);$('#db_details .notification').hide(anim);$('#field_numbers').hide(anim);$('#all_fields').show(anim);}else{$('#primary_key_field').val('');$('#all_fields').empty();}}
else{$('#db_details').hide(anim);$('#all_fields').hide(anim);$('.match-existing-notes').hide(anim);}}
function storeFormData(){$('#module_form :input').each(function(){var fldId=$(this).attr('id'),fldVal=$(this).val();if($(this).is(':checkbox')&&$(this).is(':not(:checked)')){fldVal='uncheck';}
if($(this).is(':radio')&&$(this).is(':not(:checked)')){return;}
if(fldId&&fldVal){localStorage[fldId]=fldVal;}});}
function getFormData(){var i=0,key,value;for(i=0;i<localStorage.length;i++){key=localStorage.key(i);value=localStorage[key];if(key.indexOf('/')>-1){continue;}
if($('#'+key).is(':checkbox, :radio')){if($('#'+key).val()==value){$('#'+key).attr('checked','checked');}else{$('#'+key).removeAttr('checked');value=$('#'+key).val();}}
$('#'+key).val(value);}
localStorage.clear();}
if(localStorage.length>=1){getFormData();}
$('#field_numbers a').click(function(){storeFormData();});$('#module_form').submit(function(){storeFormData();});showTableProperties();$('input[name=module_db]').click(function(){showTableProperties();});$('.mb_show_advanced').click(function(e){var anim=bonfire.builder.animation,parent;e.preventDefault();parent=$(this).closest('fieldset').attr('id');$('#'+parent+' .mb_advanced').toggle(anim);});$('.mb_show_advanced_rules').click(function(e){var anim=bonfire.builder.animation;e.preventDefault();$(this).parent().parent().next('.mb_advanced').toggle(anim);});$('.body legend').click(function(){var anim=bonfire.builder.animation,closeIcon=bonfire.builder.legendIcon.close,openIcon=bonfire.builder.legendIcon.open;$(this).parent('fieldset').children('div:not(".mb_advanced:hidden")').toggle(anim);if($(this).children('.'+closeIcon).length>0){$(this).children('.'+closeIcon).replaceWith('<span class="'+openIcon+'"></span>');}else{$(this).children('.'+openIcon).replaceWith('<span class="'+closeIcon+'"></span>');}});$('.body legend').prepend('<span class="'+bonfire.builder.legendIcon.close+'">&nbsp;');$('.faded input').on('focus',function(){$(this).closest('.faded').addClass('faded-focus');});$('.faded input').on('blur',function(){$(this).closest('.faded').removeClass('faded-focus');});$('.faded input:focus').closest('.faded').addClass('faded-focus');$('#module_name, #table_name').on('click focus blur',{valueToPrep:'',setTableName:true},bonfire.builder.prepTableName);